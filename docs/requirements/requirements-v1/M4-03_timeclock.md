# M4-03 打刻画面 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 「今日やること」入力後に「出勤する」ボタンを押すと現在時刻で出勤記録を作成する |
| Must | 出勤記録作成と同時に Slack 通知を送信する（Slack 失敗でも打刻は記録する） |
| Must | 出勤後に「退勤する」ボタンを押すと現在時刻で退勤記録を作成し、実働時間を算出する |
| Must | 退勤時に「休憩時間（分）」「今日やったこと」「明日やること」の入力を必須とする |
| Must | 退勤記録作成と同時に Slack 通知を送信する（Slack 失敗でも打刻は記録する） |
| Must | 二重出勤（当日すでに出勤済み）を拒否する |
| Must | 「今日やること」未入力で出勤ボタン押下はバリデーションエラーを表示する |
| Must | 全ロールが自分の打刻のみ操作できる |
| Must | 退勤後は当日の勤務サマリー（出勤・退勤・実働時間）を表示する |
| Should | 状態に応じて UI を切り替える（未打刻 / 出勤後退勤前 / 退勤後） |
| Should | Slack 通知先チャンネルを画面に表示する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 「今日やること」を入力して「出勤する」を押すと出勤記録が作成される
- [ ] 「今日やること」未入力で出勤ボタンを押すと「今日やることを入力してください」が表示される
- [ ] 出勤後に退勤画面（出勤時刻・退勤ボタン・各入力欄）に切り替わる
- [ ] 退勤時に必須項目が未入力だと各項目に「入力してください」が表示される
- [ ] 退勤ボタン押下後、勤務サマリーが表示される
- [ ] Slack 通知失敗時「Slack 通知に失敗しましたが、打刻は記録されました」トーストが表示される
- [ ] 二重出勤で「本日はすでに出勤済みです」が表示される
- [ ] 実働時間 = 退勤時刻 − 出勤時刻 − 休憩時間（分）で計算される

## データ要件

| エンティティ | 項目 | 制約 |
|------------|------|------|
| `ATTENDANCE` | id, member_id, date, clock_in, clock_out, break_minutes, work_minutes, todo_today, done_today, todo_tomorrow | date: 1 日 1 レコード（一意制約） |

実働時間 = `(clock_out - clock_in)` の分数 − `break_minutes`

Slack 通知内容:
- 出勤時: `[氏名] が出勤しました（HH:MM）\n本日のタスク: [今日やること]`
- 退勤時: `[氏名] が退勤しました（HH:MM）\n勤務時間: X時間Y分\n実績: [今日やったこと]\n明日の予定: [明日やること]`

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 打刻ボタン押下から記録完了まで 1 秒以内。Slack 通知は非同期処理（打刻の応答をブロックしない） |
| セキュリティ | 認証必須。他メンバーの打刻は操作不可（サーバー側で member_id を検証） |
| 監査 | 出退勤記録の作成・修正を「誰が・いつ・時刻・変更前後」で監査ログに記録 |
| ログ | Slack 通知失敗のエラー詳細をサーバーログに記録 |
| UX | 出勤から退勤完了まで 1 分以内で完了できる操作フローを目標とする |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| 「今日やること」未入力で出勤 | 「今日やることを入力してください」 | 打刻を中断 |
| Slack 通知失敗 | 「Slack 通知に失敗しましたが、打刻は記録されました」トースト | 打刻は正常完了 |
| 二重出勤 | 「本日はすでに出勤済みです」 | 打刻を中断 |
| 退勤時必須項目未入力 | 各項目に「入力してください」 | 打刻を中断 |
| DB 保存失敗 | 「打刻の記録に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
