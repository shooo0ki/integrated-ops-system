# M2-02 スキル設定 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | スキルカテゴリを追加・編集・削除できる |
| Must | スキル項目を追加・編集・削除できる（カテゴリに紐づける） |
| Must | カテゴリ名はシステム内で一意であることをバリデーションする |
| Must | スキル名はカテゴリ内で一意であることをバリデーションする |
| Must | 評価データが存在するスキル項目は削除できない |
| Must | 管理者以外はこの画面にアクセスできない |
| Should | カテゴリとスキル項目をドラッグ&ドロップで並べ替え、表示順を変更できる |
| Could | カテゴリ・スキル項目の説明文を設定できる |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者が新規カテゴリを追加できる
- [ ] カテゴリ名が重複する場合「同名のカテゴリがすでに存在します」が表示される
- [ ] 管理者が新規スキル項目をカテゴリに追加できる
- [ ] 評価データが存在するスキルを削除しようとすると「このスキルには評価データが存在するため削除できません」が表示される
- [ ] 評価データがないスキルは削除できる
- [ ] ドラッグ&ドロップで並べ替え後に保存すると、表示順が変更される
- [ ] 管理者以外でアクセスすると 403 が返る

## データ要件

| エンティティ | 項目 | 制約 |
|------------|------|------|
| `SKILL_CATEGORY` | id, name, description, display_order | name: 最大 50 文字・一意 |
| `SKILL` | id, name, description, category_id, display_order | name: 最大 100 文字・カテゴリ内一意 |
| `MEMBER_SKILL` | skill_id | スキル削除時の参照チェックに使用 |

削除前に `MEMBER_SKILL` に該当 `skill_id` が存在するかをチェックし、存在する場合は削除を拒否する。

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 追加・編集・削除操作は 200ms 以内 |
| セキュリティ | 管理者ロールのみアクセス可（サーバー側検証） |
| 監査 | カテゴリ・スキルの追加・編集・削除を監査ログに記録 |
| ログ | バリデーションエラー・DB エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| カテゴリ名重複 | 「同名のカテゴリがすでに存在します」 | 保存を中断 |
| スキル名重複（カテゴリ内） | 「このカテゴリ内に同名のスキルがすでに存在します」 | 保存を中断 |
| 評価データありのスキル削除 | 「このスキルには評価データが存在するため削除できません」 | 削除を中断 |
| DB 操作失敗 | 「操作に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
