# M4-02 勤務予定登録 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 翌週の勤務予定（曜日ごとの開始・終了時刻）を登録・更新できる |
| Must | 出勤する曜日は開始時刻を必須とし、終了時刻は開始時刻より後であることをバリデーションする |
| Must | 「終日休み」チェックボックスで曜日単位の休みを設定できる |
| Must | 本人は前日までの予定を変更できる（当日以降は変更不可） |
| Must | 管理者は全メンバーの予定を登録・変更できる（当日以降も可） |
| Must | 前週からコピーボタンで前週の設定を翌週に複製できる |
| Must | 保存ボタンで予定を登録（同週の既存データは上書き） |
| Should | 対象週（翌週の日付）を画面に明示する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 月曜〜日曜の開始・終了時刻を入力して保存すると予定が登録される
- [ ] 終了時刻が開始時刻と同じ or 前の場合「終了時刻は開始時刻より後に設定してください」が表示される
- [ ] 本人が当日以降の予定を変更しようとすると「当日以降の予定変更は管理者のみ行えます」が表示される
- [ ] 管理者は当日以降の予定も変更できる
- [ ] 「前週からコピー」で前週の設定が翌週の入力フォームにコピーされる
- [ ] 「終日休み」チェックで対象曜日の時刻入力が無効化される
- [ ] 保存後、同週の既存データが上書きされる

## データ要件

| エンティティ | 項目 | 制約 |
|------------|------|------|
| `WORK_SCHEDULE` | member_id, date (各曜日の日付), start_time, end_time, is_day_off | 1 日 1 レコード |

出勤する曜日: `is_day_off = false` かつ `start_time` が設定されている
終日休みの曜日: `is_day_off = true`

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 保存 API 応答 200ms 以内 |
| セキュリティ | 認証必須。本人以外のデータ変更はサーバー側で検証（管理者は例外） |
| 監査 | 予定の変更を「誰が・いつ・対象メンバー・対象日・変更前後の時刻」で監査ログに記録 |
| ログ | バリデーションエラー・DB エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| 終了時刻 ≤ 開始時刻 | 「終了時刻は開始時刻より後に設定してください」 | 保存を中断 |
| 本人が当日以降を変更 | 「当日以降の予定変更は管理者のみ行えます」 | 保存を中断 |
| DB 保存失敗 | 「保存に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
