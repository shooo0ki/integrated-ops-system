# M3-05 工数管理 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 対象月を選択し、メンバー × PJ マトリクス（行: メンバー / 列: PJ / セル: 工数時間）を表示する |
| Must | 編集モードでセルを直接編集し、月間工数を変更できる |
| Must | 変更を一括保存できる |
| Must | 工数が負の値の場合はバリデーションエラーを表示する |
| Must | 行合計・列合計を自動表示する |
| Must | 管理者は全 PJ・全メンバーを閲覧・編集できる |
| Must | マネージャーは担当 PJ のみ閲覧・編集できる |
| Must | 社員・インターンはアクセス不可（403） |
| Should | 前月・翌月のナビゲーションで月を切り替えられる |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者でアクセスすると当月の全メンバー × 全 PJ マトリクスが表示される
- [ ] 工数セルを編集して保存すると値が更新される
- [ ] 工数に負の値を入力すると「0 以上の値を入力してください」が表示される
- [ ] 行合計・列合計が自動計算される
- [ ] 前月・翌月ナビで月を切り替えると対応データが読み込まれる
- [ ] マネージャーが担当外 PJ の列を含む画面を表示できない（担当 PJ のみ表示）
- [ ] 社員でアクセスすると 403 が返る

## データ要件

| エンティティ | 項目 | 備考 |
|------------|------|------|
| `PROJECT_ASSIGNMENT` | member_id, project_id, workload_hours, start_date, end_date | マトリクスデータソース |
| `PROJECT` | id, name | 列ヘッダー |
| `MEMBER` | id, name | 行ヘッダー |

工数マトリクスの表示対象: 当該月に `start_date <= 月末 AND (end_date IS NULL OR end_date >= 月初)` を満たすアサインのみ

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | マトリクス表示 3 秒以内 |
| セキュリティ | 認証必須。マネージャーの担当外データはサーバー側で除外 |
| 監査 | 工数変更を「誰が・いつ・メンバー・PJ・変更前後の工数」で監査ログに記録 |
| ログ | 保存エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| 工数が負の値 | 「0 以上の値を入力してください」 | 保存を中断 |
| 権限外へのアクセス | 403 | — |
| DB 保存失敗 | 「保存に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
