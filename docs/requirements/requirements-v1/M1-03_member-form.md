# M1-03 メンバー登録 / 編集 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 管理者は新規メンバーを全項目入力して登録できる |
| Must | 管理者は既存メンバーの全項目を編集できる |
| Must | 社員・インターン（本人）は自分の氏名・電話番号・住所・銀行口座情報のみ編集できる |
| Must | マネージャーはメンバー登録・編集を行えない |
| Must | 時給制メンバーの場合、住所・銀行口座情報（銀行名・支店名・口座番号・口座名義）を必須とする |
| Must | メールアドレスはシステム内で一意であることをバリデーションする |
| Must | 退社日は入社日以降であることをバリデーションする |
| Must | プロフィール画像アップロードは JPEG/PNG・5MB 以内を許容する |
| Must | 保存成功後、M1-02 メンバー詳細または M1-01 一覧に遷移する |
| Should | 編集時にキャンセルボタンで変更を破棄して前の画面に戻る |
| Could | 画像のプレビュー表示をアップロード前に表示する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者が全必須項目を入力して保存すると新規メンバーが作成される
- [ ] 重複するメールアドレスで保存すると「このメールアドレスはすでに登録されています」が表示される
- [ ] 時給制を選択して住所を空のまま保存すると「時給制メンバーは住所を入力してください」が表示される
- [ ] 退社日に入社日より前の日付を入力すると「退社日は入社日以降に設定してください」が表示される
- [ ] 5MB 超の画像をアップロードするとエラーが表示される
- [ ] 社員（本人）が氏名・電話・住所・銀行口座のみ編集して保存できる
- [ ] 社員（本人）がロール・報酬情報を変更しようとしても対象フィールドは表示されない
- [ ] マネージャーでフォームにアクセスすると 403 が返る

## データ要件

| フィールド | 型 | 必須 | 制約 |
|-----------|------|------|------|
| name | string | ○ | 最大 100 文字 |
| email | string | ○ | メール形式・一意 |
| phone | string | - | 数字・ハイフン |
| address | string | △ | 時給制メンバーは必須 |
| status | enum | ○ | 役員/社員/本採用インターン/研修インターン/研修メンバー |
| role | enum | ○ | 管理者/マネージャー/社員/インターン |
| salary_type | enum | ○ | 時給制/月額固定 |
| salary_amount | integer | ○ | 正の整数 |
| company | enum | ○ | ブーストコンサルティング/SALT2 |
| joined_at | date | ○ | YYYY-MM-DD |
| left_at | date | - | joined_at 以降 |
| bank_name | string | △ | 時給制は必須、最大 100 文字 |
| branch_name | string | △ | 時給制は必須、最大 100 文字 |
| account_number | string | △ | 時給制は必須、数字 7 桁 |
| account_holder | string | △ | 時給制は必須、最大 100 文字 |
| profile_image | file | - | JPEG/PNG・5MB 以内 |

銀行口座情報は暗号化して DB に保存する。

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 保存 API 応答 200ms 以内。画像アップロードは別途非同期処理可 |
| セキュリティ | 銀行口座情報は暗号化保存（AES-256 等）。フォームの権限制御はサーバー側でも検証 |
| 監査 | 登録・編集・削除操作を「誰が・いつ・何を変更したか（変更前後の値）」で監査ログに記録 |
| ログ | バリデーションエラー・保存失敗をサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| メール重複 | 「このメールアドレスはすでに登録されています」 | 保存を中断 |
| 時給制で住所空 | 「時給制メンバーは住所を入力してください」 | 保存を中断 |
| 退社日 < 入社日 | 「退社日は入社日以降に設定してください」 | 保存を中断 |
| 5MB 超の画像 | 「ファイルサイズは 5MB 以内にしてください」 | アップロードを中断 |
| JPEG/PNG 以外の画像 | 「JPEG または PNG 形式のファイルを選択してください」 | アップロードを中断 |
| DB 保存失敗 | 「保存に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
