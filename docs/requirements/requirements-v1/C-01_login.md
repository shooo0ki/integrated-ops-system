# C-01 ログイン画面 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | Slack OAuth 2.0 フローによるログインを提供する |
| Must | Google OAuth 2.0 フローによるログインを提供する |
| Must | OAuth コールバック後にメールアドレスで `USER_ACCOUNT` と照合し、未登録の場合はエラーを表示してアクセスを拒否する |
| Must | 認証成功後、ロール情報を含むセッションを生成し、ダッシュボード（C-02）にリダイレクトする |
| Must | セッション有効期限は 24 時間とし、期限切れ時はログイン画面にリダイレクトしてメッセージを表示する |
| Should | ロゴ・システム名・フッター（バージョン情報）を表示する |
| Could | 今後のメール＋パスワード認証に備えた拡張ポイントを設計段階で確保する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 「Slack でログイン」ボタン押下で Slack OAuth フローが開始される
- [ ] 「Google でログイン」ボタン押下で Google OAuth フローが開始される
- [ ] 登録済みアカウントでの認証後、C-02 にリダイレクトされる
- [ ] 未登録メールで認証した場合、「このアカウントはシステムに登録されていません。管理者にお問い合わせください。」が表示される
- [ ] OAuth プロバイダー側でエラーが発生した場合、「ログインに失敗しました。再度お試しください。」が表示される
- [ ] セッション期限切れ状態でページアクセスした場合、ログイン画面にリダイレクトされ「セッションが切れました。再ログインしてください。」が表示される
- [ ] ログイン画面は認証なしでアクセス可能（パブリック）

## データ要件

| エンティティ | 項目 | 用途 |
|------------|------|------|
| `USER_ACCOUNT` | メールアドレス | OAuth プロバイダーから取得したメールと照合 |
| `USER_ACCOUNT` | ロール | ログイン後の権限制御に使用 |
| `USER_ACCOUNT` | OAuthプロバイダー種別 | Slack / Google の識別 |
| `MEMBER` | member_id | アカウントに紐づくメンバー情報の参照 |

セッションに含める最低限の情報: `user_id`, `member_id`, `role`, `email`, `expires_at`

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | ページ表示 3 秒以内、OAuth コールバック処理 2 秒以内 |
| セキュリティ | HTTPS 必須、CSRF トークン保護、OAuth state パラメータ検証、セッション Cookie に `HttpOnly` / `Secure` / `SameSite=Lax` を設定 |
| 監査 | ログイン成功・失敗（メールアドレス・タイムスタンプ・IPアドレス）をログに記録 |
| ログ | 認証フロー全ステップのエラーをサーバーログに出力 |
| セッション | 有効期限 24 時間、ブラウザ閉じても継続（Cookie ベース） |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| 未登録メールでの認証 | 「このアカウントはシステムに登録されていません。管理者にお問い合わせください。」 | セッションを生成せず、ログイン画面に留まる |
| OAuth 認証失敗（プロバイダー側エラー） | 「ログインに失敗しました。再度お試しください。」 | エラーログ記録、ログイン画面に戻す |
| セッション期限切れ | 「セッションが切れました。再ログインしてください。」 | ログイン画面にリダイレクト |
| ネットワーク障害 | 一般的なエラーメッセージ | リトライ案内 |
