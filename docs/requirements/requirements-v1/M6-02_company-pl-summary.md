# M6-02 全社 PL サマリー — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | ブーストコンサルティング / SALT2 / 両社 を選択し、全 PJ を合算した会社全体の損益を表示する |
| Must | PJ 別明細（売上合計・コスト合計・粗利・粗利率）と全社合計行を表示する |
| Must | 対象月を選択できる（前月・翌月ナビゲーション付き） |
| Must | 管理者以外はアクセス不可（403） |
| Must | PJ が 0 件の場合は案内メッセージを表示する |
| Should | 月次推移グラフ（売上・コスト・粗利の折れ線）を表示する |
| Should | PJ 別粗利率ランキングを表示する |
| Should | PJ 名クリックで M6-01 PJ 別 PL に遷移する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者でアクセスすると当月の全社 PL サマリーが表示される
- [ ] 管理者以外でアクセスすると 403 が返る
- [ ] 会社フィルター「SALT2」で SALT2 の PJ のみ集計された値が表示される
- [ ] PJ が 0 件の場合「進行中のプロジェクトがありません」が表示される
- [ ] 全社合計行が全 PJ の合算で正しく表示される
- [ ] PJ 名クリックで M6-01 に遷移する

## データ要件

| エンティティ | 項目 | 備考 |
|------------|------|------|
| `PL_RECORD` | project_id, target_month, revenue_contract, revenue_extra, cost_outsourcing, cost_other | 手動入力部分 |
| `PROJECT` | id, name, company | PJ 別表示・会社フィルター |
| `PROJECT_ASSIGNMENT` | project_id, member_id, workload_hours | 人件費自動計算用（M6-01 と同様） |
| `MEMBER` | salary_type, salary_amount | 人件費計算用 |
| `ATTENDANCE` | work_minutes | 時給制人件費用 |

全社合計:
- 売上合計 = Σ(各 PJ の売上合計)
- コスト合計 = Σ(各 PJ のコスト合計)
- 粗利 = 売上合計 − コスト合計
- 粗利率 = 粗利 / 売上合計（売上 0 の場合は「—」）

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | サマリー表示 3 秒以内 |
| セキュリティ | 管理者ロールのみアクセス可（サーバー側検証） |
| 監査 | 閲覧ログ（ユーザー・タイムスタンプ）を記録 |
| ログ | API エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| PJ が 0 件 | 「進行中のプロジェクトがありません」 | — |
| データ取得失敗 | エラートースト | リロード案内 |
| 権限外アクセス | 403 | — |
