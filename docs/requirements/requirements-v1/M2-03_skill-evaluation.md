# M2-03 スキル評価入力 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 対象メンバーのスキルカテゴリ別にスキルレベル（1〜5）を入力・更新できる |
| Must | 評価日（過去日または当日）と評価メモ（任意）を登録できる |
| Must | 評価は履歴として追記される（上書きではなく時系列で保持） |
| Must | 現在のレベル（最新評価値）とレベルラベルを表示する |
| Must | 評価履歴（評価日・レベル・メモの時系列）を表示する |
| Must | 管理者は全メンバーを評価できる |
| Must | マネージャーは担当 PJ メンバーのみ評価できる |
| Must | 社員・インターンは自分のスキルを閲覧のみ（評価不可） |
| Must | レベル未選択で保存しようとするとバリデーションエラーを表示する |
| Should | スキルカテゴリをタブで切り替えて表示する |
| Should | 評価履歴はアコーディオンで折りたたみ表示する |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者がスキルレベル 3・評価日・メモを入力して保存すると評価が追加される
- [ ] 保存後、最新レベルが 3 に更新される
- [ ] 評価履歴に新しい評価が追加される
- [ ] レベル未選択で保存ボタンを押すと「レベルを選択してください」が表示される
- [ ] 評価日に未来の日付を入力するとバリデーションエラーが表示される
- [ ] マネージャーが担当外メンバーの評価画面にアクセスすると 403 が返る
- [ ] 社員でアクセスすると入力フォームが非表示（閲覧のみ）
- [ ] レベルラベルが正しく表示される（1=初学者 / 2=初級 / 3=中級 / 4=上級 / 5=エキスパート）

## データ要件

| エンティティ | 項目 | 制約 |
|------------|------|------|
| `MEMBER_SKILL` | id, member_id, skill_id, level (1〜5), evaluated_at, memo, evaluated_by | 評価ごとにレコード追加（履歴保持） |
| `SKILL` | id, name, category_id | スキル情報の表示用 |
| `MEMBER` | id, name | 対象メンバーのヘッダー表示用 |

「現在のレベル」= 当該 member_id × skill_id の `evaluated_at` が最新のレコードの level

レベルラベル定義:
| level | ラベル |
|-------|--------|
| 1 | 初学者 |
| 2 | 初級 |
| 3 | 中級 |
| 4 | 上級 |
| 5 | エキスパート |

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 評価保存 API 応答 200ms 以内 |
| セキュリティ | 権限チェックはサーバー側で実施（マネージャーの担当外アクセスを拒否） |
| 監査 | 評価追加・変更操作を「評価者・対象メンバー・スキル・前後のレベル・日時」で監査ログに記録 |
| ログ | 権限エラー・DB エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| レベル未選択で保存 | 「レベルを選択してください」 | 保存を中断 |
| 評価日が未来日 | 「評価日は本日以前の日付を選択してください」 | 保存を中断 |
| 権限外メンバーへのアクセス | 403 | サーバー側でも拒否 |
| DB 保存失敗 | 「保存に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
