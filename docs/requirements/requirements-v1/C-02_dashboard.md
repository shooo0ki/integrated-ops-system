# C-02 ダッシュボード — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | ログイン後のトップページとして表示し、ロールに応じたウィジェットを出し分ける |
| Must | 社員・インターン向けに「出勤する」「退勤する」クイックアクションボタンを表示する |
| Must | 管理者・マネージャー向けに未打刻メンバー数を赤バッジで表示する |
| Must | 管理者向けに月末締め状況（確認待ち人数）を表示する |
| Must | マネージャー向けに担当 PJ 一覧（進行中のみ）を表示する |
| Must | 管理者向けに全社 PL 粗利（当月）を表示する |
| Must | 各モジュール（M1〜M6）へのナビゲーションカードを表示し、ロール権限内のものだけリンク有効にする |
| Must | ウィジェットのデータ取得失敗は独立して処理し、失敗したウィジェットだけにエラー表示する |
| Should | お知らせ・アラートエリアを設け、未打刻アラート・月末締め通知をクリックで該当画面に遷移できる |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者でログインすると全ウィジェットが表示される
- [ ] マネージャーでログインすると「担当 PJ 一覧」「打刻状態」のみが表示される
- [ ] 社員・インターンでログインすると「本日の打刻状態」と限定モジュールカードが表示される
- [ ] 「出勤する」ボタン押下で M4-03 打刻画面に遷移する
- [ ] 特定ウィジェットのデータ取得が失敗しても、他のウィジェットは正常に表示される
- [ ] 管理者ロールで「全社 PL 粗利（当月）」が正しい数値で表示される
- [ ] 未打刻メンバー数が 0 件の場合、赤バッジは非表示

## データ要件

| エンティティ | 項目 | 用途 |
|------------|------|------|
| `ATTENDANCE` | 当日の出退勤記録 | 打刻状態・未打刻メンバー数の算出 |
| `PROJECT` | status, company | 進行中 PJ 一覧（マネージャー向け） |
| `PROJECT_ASSIGNMENT` | member_id, project_id | 担当 PJ 抽出 |
| `PL_RECORD` | 粗利額, 対象月 | 全社粗利ウィジェット（管理者） |
| `INVOICE` | 承認状態, 対象月 | 月末締め確認待ち人数 |

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | ダッシュボード初期表示 3 秒以内。ウィジェットは並列取得（並列 API 呼び出し）で実装する |
| セキュリティ | 認証必須。未認証アクセスはログイン画面にリダイレクト。ロール外ウィジェットはサーバー側でも除外 |
| 監査 | ダッシュボードアクセスログ（ユーザー・タイムスタンプ）を記録 |
| ログ | ウィジェット API エラーはサーバーログに記録（エラーコード・エンドポイント） |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| ウィジェットデータ取得失敗 | 該当ウィジェットに「データを取得できませんでした」を表示 | 他ウィジェットへ影響しない |
| 未認証でアクセス | ログイン画面にリダイレクト | — |
| 全ウィジェット同時失敗 | 各ウィジェットに個別エラー表示 | リロードを促すメッセージ |
