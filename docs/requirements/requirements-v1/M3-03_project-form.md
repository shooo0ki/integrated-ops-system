# M3-03 プロジェクト登録 / 編集 — 要件定義 v1

## 機能要件

| 優先度 | 要件 |
|--------|------|
| Must | 新規プロジェクトを基本情報（名称・ステータス・所属会社・開始日・終了日・クライアント名・契約形態・月額）で登録できる |
| Must | 既存プロジェクトを編集できる |
| Must | ポジションを複数定義できる（名称・必要人数・必要スキル） |
| Must | 終了日が開始日より前の場合はバリデーションエラーを表示する |
| Must | アサインがあるポジションは削除できない |
| Must | 管理者は全 PJ の作成・編集ができる |
| Must | マネージャーは担当 PJ のみ編集できる（新規作成も可） |
| Must | 社員・インターンはアクセス不可（403） |
| Should | ポジション定義でドロップダウンから既存ポジション名を選択、または新規入力できる |
| Should | 必要スキルとして「スキル + 最低レベル」を複数設定できる |

## 受け入れ条件（Acceptance Criteria）

- [ ] 管理者が全必須項目を入力して保存すると新規 PJ が作成される
- [ ] 終了日に開始日より前の日付を入力すると「終了日は開始日以降に設定してください」が表示される
- [ ] アサインがあるポジションを削除しようとすると「アサイン済みのポジションは削除できません」が表示される
- [ ] アサインがないポジションは削除できる
- [ ] マネージャーが担当外 PJ の編集画面にアクセスすると 403 が返る
- [ ] 社員でアクセスすると 403 が返る
- [ ] ポジションを複数追加できる
- [ ] 保存後、M3-02 プロジェクト詳細に遷移する

## データ要件

### プロジェクト基本情報

| フィールド | 型 | 必須 | 制約 |
|-----------|------|------|------|
| name | string | ○ | 最大 200 文字 |
| description | string | - | 最大 1000 文字 |
| status | enum | ○ | 計画中/進行中/完了/保留 |
| company | enum | ○ | ブーストコンサルティング/SALT2 |
| start_date | date | ○ | YYYY-MM-DD |
| end_date | date | - | start_date 以降 |
| client_name | string | - | 最大 200 文字 |
| contract_type | enum | - | 準委任/請負/自社開発/その他 |
| monthly_contract_amount | integer | - | 0 以上 |

### ポジション定義（繰り返し）

| フィールド | 型 | 必須 | 制約 |
|-----------|------|------|------|
| position_name | string | ○ | 既存選択 or 新規入力 |
| required_count | integer | ○ | 1 以上 |
| required_skills | array | - | スキル ID + 最低レベル（1〜5）の配列 |

## 非機能要件（暫定）

| 区分 | 内容 |
|------|------|
| 性能 | 保存 API 応答 200ms 以内 |
| セキュリティ | 認証必須。マネージャーの担当外 PJ 編集はサーバー側で拒否 |
| 監査 | PJ 作成・編集・削除を「誰が・いつ・変更前後の主要項目」で監査ログに記録 |
| ログ | バリデーションエラー・DB エラーをサーバーログに記録 |

## 想定エラーと対処

| エラー条件 | 表示 / 挙動 | 対処方針 |
|-----------|------------|---------|
| 終了日 < 開始日 | 「終了日は開始日以降に設定してください」 | 保存を中断 |
| アサインありのポジション削除 | 「アサイン済みのポジションは削除できません」 | 削除を中断 |
| 必須項目が空 | 各フィールドに「入力してください」 | 保存を中断 |
| DB 保存失敗 | 「保存に失敗しました。再度お試しください。」 | サーバーエラーログ記録 |
