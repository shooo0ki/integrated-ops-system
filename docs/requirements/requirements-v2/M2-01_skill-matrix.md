# M2-01 スキルマトリクス — 要件定義 v2（確定版）

> 作成日: 2026-02-20 | v1 → v2 更新

---

## v1 からの変更点

| 区分 | 内容 |
|------|------|
| データ要件 | テーブル名を物理名に統一。最新評価取得クエリ（DISTINCT ON）を明記 |
| 非機能要件 | 確定値に更新。100名×50スキル=5000セルのレンダリング最適化方針を追記 |
| 運用要件 | セクション新設 |

---

## 機能要件（確定）

| 優先度 | 要件 |
|--------|------|
| Must | 全メンバーのスキルレベル（1〜5）をマトリクス形式（行: メンバー / 列: スキル）で一覧表示する |
| Must | 未評価のセルは「—」（グレー背景）で表示する |
| Must | スキルレベルを色分けで表示する（1=グレー / 2=黄 / 3=緑 / 4=青 / 5=紫） |
| Must | 最終スキル更新日を表示し、3 ヶ月以上未更新のメンバーをオレンジで強調する |
| Must | 「Dev」「Biz」タブで列セットを切替える（Dev=エンジニアリング系、Biz=ビジネス系） |
| Must | スキルカテゴリ / 最低レベル / 所属会社でフィルタリングができる |
| Must | セルクリックで M2-03 スキル評価入力に遷移する（admin/manager のみ） |
| Must | メンバー名クリックで M1-02 メンバー詳細に遷移する |
| Must | スキル項目が 0 件の場合、案内メッセージを表示する |
| Should | インターンは自分のスキル行のみ表示する |
| Should | カテゴリでグループ化して列を表示する（`skill_categories.display_order` 順） |

---

## データ要件（確定）

| テーブル | カラム | 用途 |
|---------|--------|------|
| `members` | `id`, `name`, `company`, `deleted_at` | 行データ（deleted_at IS NULL） |
| `skill_categories` | `id`, `name`, `display_order` | 列グループ |
| `skills` | `id`, `name`, `category_id`, `display_order` | 列データ |
| `member_skills` | `member_id`, `skill_id`, `level`, `evaluated_at` | セルデータ（最新評価のみ） |

**最新評価取得クエリ（確定）:**
```sql
SELECT DISTINCT ON (member_id, skill_id)
  member_id, skill_id, level, evaluated_at
FROM member_skills
ORDER BY member_id, skill_id, evaluated_at DESC
```

**最終スキル更新日:** 当該メンバーの全 `member_skills.evaluated_at` の MAX 値

**3ヶ月未更新判定:** `MAX(evaluated_at) < NOW() - INTERVAL '3 months'`

**スキルレベル定義（5段階）:**

| レベル | ラベル | 定義 |
|-------|--------|------|
| 1 | 初学者 | 基本的な知識を学習中。指導の下で簡単なタスクが実行できる |
| 2 | 初級 | 基本的なタスクを自力で遂行できる。標準的な問題を解決できる |
| 3 | 中級 | 複雑なタスクを自力で遂行できる。他者への指導が可能 |
| 4 | 上級 | 高度な問題解決ができる。設計・アーキテクチャの判断が可能 |
| 5 | エキスパート | 該当分野の第一人者。技術方針を策定できる |

**初期カテゴリ・スキル項目（Dev/Bizタブで切替）:**

*Dev（エンジニアリング/テクニカル）*
- フロントエンド（React/Vue 等）
- バックエンド（API設計・サーバサイド）
- インフラ（AWS/GCP 等）
- データサイエンス
- LLM
- 技術理解 / 技術提案

*Biz（ビジネス）*
- PM力（PM/進捗・リスク管理）
- 営業力（折衝・提案・リレーション）
- スライドライティング力（資料構成・デザイン）
- 提案力（課題分析〜解決策提示）

---

## 非機能要件（確定）

| 区分 | 内容 |
|------|------|
| 性能 | マトリクス表示 2 秒以内（最大 100 名 × 50 スキル = 5,000 セル）。仮想スクロール（react-virtual等）を使用してDOM数を制限する |
| セキュリティ | 認証必須。インターンの他メンバー閲覧はサーバー側でも制限（WHERE member_id = :self） |
| 監査 | 評価変更操作のログは M2-03 側で管理 |
| ログ | データ取得エラーをサーバーログに記録 |
| 可用性 | スキルデータが 0 件でも画面が壊れないこと |

---

## 運用要件

| 項目 | 内容 |
|------|------|
| バックアップ | `member_skills` / `skills` / `skill_categories` は日次バックアップ対象 |
| データ保持 | `member_skills` は追記型。過去の評価履歴は保持し削除しない |
| 権限運用 | スキルカテゴリ・スキル項目の追加は管理者のみ（M2-02） |

---

## 受け入れ条件（確定）

- [ ] 管理者でアクセスすると全メンバーのスキルマトリクスが表示される
- [ ] レベル 3 のセルは緑色で表示される
- [ ] 未評価のセルは「—」グレー背景で表示される
- [ ] 最終更新日が 3 ヶ月超過のメンバー行がオレンジ強調される
- [ ] カテゴリフィルターで「エンジニアリング」を選択すると、対応カテゴリの列のみ表示される
- [ ] タブを「Biz」にすると Bizカテゴリ（PM力/営業力/スライドライティング力/提案力）の列セットに切り替わる
- [ ] インターンでアクセスすると自分の行のみ表示される
- [ ] 管理者がセルをクリックすると M2-03 に遷移する
- [ ] スキル項目が未登録の場合「スキルが未登録です。M2-02 でスキルを追加してください」が表示される
