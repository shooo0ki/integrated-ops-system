# M3-01 プロジェクト一覧 — 要件定義 v2（確定版）

> 作成日: 2026-02-20 | v1 → v2 更新

---

## v1 からの変更点

| 区分 | 内容 |
|------|------|
| データ要件 | テーブル名を物理名に統一。`deleted_at IS NULL` 条件を明記 |
| 非機能要件 | 確定値に更新 |
| 運用要件 | セクション新設 |

---

## 機能要件（確定）

| 優先度 | 要件 |
|--------|------|
| Must | プロジェクト一覧を表示する（PJ 名・ステータス・所属会社・クライアント名・開始日・終了予定日・アサイン人数） |
| Must | ステータス / 所属会社 / フリーワードでフィルタリングができる |
| Must | フィルター変更時に即時で一覧を更新する |
| Must | 管理者・マネージャーには「新規 PJ 作成」ボタンを表示し、M3-03 に遷移する |
| Must | 行クリックで M3-02 プロジェクト詳細に遷移する |
| Must | 社員・インターンはアサインされている PJ のみ表示する（サーバー側フィルタ） |
| Must | 論理削除済み PJ（`deleted_at IS NOT NULL`）はデフォルト非表示 |
| Should | ステータスバッジを色分けで表示する |

---

## データ要件（確定）

| テーブル | カラム | 用途 |
|---------|--------|------|
| `projects` | `id`, `name`, `status`, `company`, `client_name`, `start_date`, `end_date`, `deleted_at` | 一覧表示用 |
| `project_assignments` | `project_id`, `member_id`, `end_date` | アサイン人数計算・社員フィルタ |

**ステータスバッジ配色（確定）:**

| status 値 | 表示名 | 色 |
|-----------|--------|-----|
| `planning` | 計画中 | グレー |
| `active` | 進行中 | 緑 |
| `completed` | 完了 | 青 |
| `on_hold` | 保留 | オレンジ |

**アサイン人数:** `project_assignments` の `end_date IS NULL OR end_date >= NOW()` のレコード数

---

## 非機能要件（確定）

| 区分 | 内容 |
|------|------|
| 性能 | 一覧表示 2 秒以内 |
| セキュリティ | 認証必須。社員・インターンへの PJ フィルタリングはサーバー側で適用（クライアント側だけでは不可） |
| 監査 | 一覧閲覧ログ（ユーザー ID・タイムスタンプ）をサーバーログに記録 |
| ログ | API エラーをサーバーログに記録 |
| 可用性 | データ取得失敗時にリトライが可能 |

---

## 運用要件

| 項目 | 内容 |
|------|------|
| バックアップ | `projects` は日次バックアップ対象 |
| データ保持 | `projects.deleted_at` 設定で論理削除。PL・アサイン履歴のために物理削除しない |
| 権限運用 | PJ 作成・編集は admin / manager。閲覧は全ロール（範囲はロールによる） |

---

## 受け入れ条件（確定）

- [ ] 管理者でアクセスすると全 PJ（deleted_at IS NULL）が表示される
- [ ] 社員・インターンでアクセスすると自分がアサインされた PJ のみ表示される
- [ ] ステータスフィルターで「進行中」を選択すると該当 PJ のみ表示される
- [ ] 検索結果が 0 件の場合「該当するプロジェクトが見つかりません」が表示される
- [ ] 管理者・マネージャーに「新規 PJ 作成」ボタンが表示される
- [ ] 社員・インターンには「新規 PJ 作成」ボタンが表示されない
- [ ] PJ 行クリックで M3-02 に遷移する
