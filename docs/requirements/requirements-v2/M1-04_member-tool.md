# M1-04 メンバーツール管理 — 要件定義 v2（確定版）

> 作成日: 2026-02-20（新規作成）
> 参照: docs/requirements/data/member_tool.md

---

## 概要

メンバーごとに契約している有料ツール（Claude, Figma 等）の一覧・登録・編集・削除を管理する。
ツール費は M6 の PL コスト（その他経費）算定に使用される。

---

## 機能要件（確定）

| 優先度 | 要件 |
|--------|------|
| Must | メンバー詳細（M1-02）内の「利用ツール」セクションでツール一覧を表示する |
| Must | 管理者はツールを追加・編集・削除できる |
| Must | 本人はツールを閲覧のみ（追加・編集・削除は管理者のみ） |
| Must | マネージャー・社員・インターン（本人以外）はツール情報を閲覧できない |
| Must | ツール名・プラン・月額・請求先会社を登録できる |
| Must | 月額は 0 以上の整数（円）であることをバリデーションする |
| Must | 請求先会社は `boost` / `salt2` のいずれかを必須とする |
| Should | 複数ツールを一覧で表示し、月額合計を表示する |

---

## データ要件（確定）

テーブル: `member_tools`

| フィールド | 物理名 | 型 | 必須 | 制約 |
|-----------|--------|-----|------|------|
| メンバーID | `member_id` | UUID | ○ | FK → members |
| ツール名 | `tool_name` | VARCHAR(100) | ○ | 最大 100 文字 |
| プラン | `plan` | VARCHAR(50) | — | 最大 50 文字 |
| 月額 | `monthly_cost` | INTEGER | ○ | 0 以上 |
| 請求先会社 | `company_label` | ENUM | ○ | `boost` / `salt2` |
| 備考 | `note` | VARCHAR(200) | — | 最大 200 文字 |

---

## 非機能要件（確定）

| 区分 | 内容 |
|------|------|
| 性能 | CRUD 操作 200ms 以内 |
| セキュリティ | 管理者ロールのみ作成・更新・削除可。本人は閲覧のみ。それ以外は 403 |
| 監査 | ツールの追加・編集・削除を `audit_logs` に記録 |
| ログ | DB エラーをサーバーログに記録 |

---

## 運用要件

| 項目 | 内容 |
|------|------|
| バックアップ | `member_tools` は日次バックアップ対象 |
| データ保持 | 削除は物理削除（ツール費は PL_RECORD に月次集計時点で反映済みのため）|
| 権限運用 | ツール登録・更新・削除は admin のみ |

---

## 受け入れ条件（確定）

- [ ] 管理者がツール名・月額・請求先会社を入力して追加できる
- [ ] 管理者がツール情報を編集できる
- [ ] 管理者がツールを削除できる
- [ ] 本人がアクセスするとツール一覧が閲覧できる（編集ボタンは非表示）
- [ ] マネージャー・社員（本人以外）がアクセスするとツール情報は表示されない
- [ ] 月額に負の値を入力すると「0 以上の値を入力してください」が表示される
- [ ] 請求先会社が未選択の場合「請求先会社を選択してください」が表示される
- [ ] `audit_logs` にツール追加・変更のレコードが追加されている

---

## ページ配置

独立したページは設けず、**M1-02 メンバー詳細の内部セクション**として実装する。
管理者がツールを追加・編集する際はモーダルダイアログを使用する。
