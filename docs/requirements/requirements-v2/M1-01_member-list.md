# M1-01 メンバー一覧 — 要件定義 v2（確定版）

> 作成日: 2026-02-20 | v1 → v2 更新

---

## v1 からの変更点

| 区分 | 内容 |
|------|------|
| データ要件 | テーブル名を物理名に統一。`deleted_at IS NULL` 条件を明記 |
| 非機能要件 | 性能目標を 2 秒以内に引き上げ |
| 運用要件 | セクション新設 |

---

## 機能要件（確定）

| 優先度 | 要件 |
|--------|------|
| Must | メンバー一覧を表示する（氏名・プロフィール画像・ステータス・所属会社） |
| Must | 氏名またはメールアドレスによるフリーワード部分一致検索ができる |
| Must | ステータス / 所属会社 / ロールでフィルタリングができる（複数フィルターの AND 組み合わせ可） |
| Must | フィルター変更時に即時（サーバーリクエスト）で一覧を更新する |
| Must | 管理者には「新規追加」ボタンを表示し、M1-03 に遷移する |
| Must | 行クリックで M1-02 メンバー詳細に遷移する |
| Must | メールアドレス・入社日は管理者のみ表示する |
| Must | 退社済みメンバー（`left_at IS NOT NULL`）はデフォルト非表示。フィルターで「退社済み含む」を選択時に表示 |
| Should | インターンには氏名のみ表示する（プロフィール画像・ステータス等は非表示） |
| Could | ページネーション（最大 100 名想定のため初期はなしで可） |

---

## データ要件（確定）

| テーブル | カラム | 表示条件 |
|---------|--------|---------|
| `members` | `id`, `name`, `profile_image_url`, `status`, `company`, `joined_at`, `deleted_at` | 全ロール（deleted_at IS NULL がデフォルト） |
| `user_accounts` | `email`, `role` | 管理者のみ / フィルター用 |

**フィルタ選択肢（確定）:**

| フィルター | 選択肢 | DB値 |
|-----------|--------|------|
| ステータス | 役員 / 社員 / 本採用インターン / 研修インターン / 研修メンバー | `executive` / `employee` / `intern_full` / `intern_training` / `training_member` |
| 所属会社 | ブーストコンサルティング / SALT2 | `boost` / `salt2` |
| ロール | 管理者 / マネージャー / 社員 / インターン | `admin` / `manager` / `employee` / `intern` |

**クエリ条件:**
```sql
WHERE members.deleted_at IS NULL  -- デフォルト
  AND members.status = :status    -- フィルター指定時
  AND members.company = :company  -- フィルター指定時
  AND user_accounts.role = :role  -- フィルター指定時
  AND members.name ILIKE '%:q%'   -- フリーワード検索
```

---

## 非機能要件（確定）

| 区分 | 内容 |
|------|------|
| 性能 | 一覧表示 2 秒以内。最大 100 名のデータを想定。フィルター変更時も 2 秒以内 |
| セキュリティ | 認証必須。管理者専用項目（email, joined_at）はサーバー側でロールを検証してからレスポンスに含める |
| 監査 | 一覧閲覧ログ（ユーザー ID・タイムスタンプ）をサーバーログに記録 |
| ログ | API エラーはサーバーログに記録 |
| 可用性 | データ取得失敗時にリトライが可能なこと |

---

## 運用要件

| 項目 | 内容 |
|------|------|
| データ保持 | `members.deleted_at` を設定することで論理削除。物理削除は行わない |
| バックアップ | `members` テーブルは日次バックアップ対象 |
| 権限運用 | メンバー閲覧は全ロール可。メール・入社日表示は管理者限定 |

---

## 受け入れ条件（確定）

- [ ] 全ロールでメンバー一覧が表示される（deleted_at IS NULL のメンバーのみ）
- [ ] 管理者でアクセスするとメールアドレス・入社日の列が表示される
- [ ] 社員・マネージャーでアクセスするとメールアドレス・入社日の列が非表示
- [ ] インターンでアクセスすると氏名のみ表示される
- [ ] 「田中」で検索すると氏名に「田中」を含むメンバーのみ表示される
- [ ] ステータスフィルターで「研修インターン」を選択すると該当メンバーのみ表示される
- [ ] 検索結果が 0 件の場合「該当するメンバーが見つかりません」が表示される
- [ ] データ取得失敗時にエラートーストとリトライボタンが表示される
- [ ] 管理者でのみ「新規追加」ボタンが表示される
- [ ] プロフィール画像読み込み失敗時にデフォルトアバターが表示される
