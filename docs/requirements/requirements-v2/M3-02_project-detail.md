# M3-02 プロジェクト詳細 — 要件定義 v2（確定版）

> 作成日: 2026-02-20 | v1 → v2 更新

---

## v1 からの変更点

| 区分 | 内容 |
|------|------|
| データ要件 | テーブル名を物理名に統一。充足人数の算出条件を明確化 |
| 非機能要件 | 確定値に更新 |
| 運用要件 | セクション新設 |

---

## 機能要件（確定）

| 優先度 | 要件 |
|--------|------|
| Must | PJ の基本情報（名称・ステータス・期間・クライアント・所属会社）を表示する |
| Must | ポジション一覧（名称・必要人数・現充足人数・空き状況）を表示する |
| Must | アサイン済みメンバーリスト（名前・ポジション・月間工数・期間）を表示する |
| Must | 契約形態・月額契約金額は管理者のみ表示する |
| Must | 管理者・マネージャー（担当 PJ のみ）に「編集」ボタンを表示する |
| Must | 存在しない PJ ID は 404 を返す |
| Must | 社員・インターンはアサインされている PJ のみ閲覧可（それ以外は 403） |
| Should | 「アサイン管理」ボタンで M3-04 に遷移する（admin / manager のみ） |
| Should | 「工数管理」ボタンで M3-05 に遷移する（admin / manager のみ） |
| Should | メンバー名クリックで M1-02 メンバー詳細に遷移する |

---

## データ要件（確定）

| テーブル | カラム | 表示条件 |
|---------|--------|---------|
| `projects` | `id`, `name`, `status`, `company`, `client_name`, `start_date`, `end_date`, `description` | 全ロール |
| `projects` | `contract_type`, `monthly_contract_amount` | 管理者のみ |
| `project_positions` | `id`, `position_name`, `required_count` | 全ロール |
| `project_assignments` | `member_id`, `position_id`, `workload_hours`, `start_date`, `end_date` | 全ロール（表示条件準拠） |
| `members` | `id`, `name` | アサイン一覧のリンク用 |

**充足人数の算出:**
```sql
SELECT position_id, COUNT(*) as current_count
FROM project_assignments
WHERE project_id = :projectId
  AND (end_date IS NULL OR end_date >= CURRENT_DATE)
GROUP BY position_id
```

---

## 非機能要件（確定）

| 区分 | 内容 |
|------|------|
| 性能 | ページ表示 2 秒以内 |
| セキュリティ | 認証必須。契約金額は管理者のみ API レスポンスに含める（サーバー側検証） |
| 監査 | 詳細閲覧ログをサーバーログに記録 |
| ログ | 403 / 404 発生をサーバーログに記録 |
| 可用性 | 部分的なデータ取得失敗でも基本情報は表示できること |

---

## 運用要件

| 項目 | 内容 |
|------|------|
| バックアップ | `projects` / `project_positions` / `project_assignments` は日次バックアップ対象 |
| データ保持 | 完了・保留の PJ も `deleted_at` なしで保持し、PL 参照が維持できること |

---

## 受け入れ条件（確定）

- [ ] 管理者でアクセスすると全情報（契約形態・月額含む）が表示される
- [ ] マネージャーでアクセスすると契約形態・月額が非表示
- [ ] 社員・インターンがアサインされた PJ の詳細を開ける
- [ ] 社員・インターンがアサインされていない PJ にアクセスすると 403 が返る
- [ ] 存在しない PJ ID にアクセスすると 404 が返る
- [ ] ポジション一覧で必要人数と充足人数が正しく表示される
- [ ] 「編集」ボタンで M3-03 に遷移する
- [ ] 「アサイン管理」ボタンで M3-04 に遷移する
