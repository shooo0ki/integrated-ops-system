# M4-04 勤怠一覧

## 目的
メンバーの勤怠履歴を月次で一覧表示し、確認・修正・承認を行う。S2 シナリオの確認フェーズで使用。

## 対象ペルソナ / シナリオ
- 山田（インターン）: S2 月末勤怠サマリー確認・OK 操作
- 田中（マネージャー）: 担当メンバーの勤怠承認
- 佐藤（管理者）: 全体確認・修正

## UI 構成
- 対象月選択
- メンバー選択（管理者・マネージャー）
- 日別勤怠テーブル
- 月次サマリー（合計勤務日数・合計時間・給与見込み）
- 承認状況バッジ
- OK ボタン / 修正依頼フォーム（インターン向け）

## 表示項目（日別テーブル）
| 項目 | 説明 |
|------|------|
| 日付 | — |
| 出勤時刻 | — |
| 退勤時刻 | — |
| 休憩時間 | 分 |
| 実働時間 | 自動計算 |
| 日報（今日やったこと） | — |
| 状態 | 通常 / 修正済 / 欠勤 |

## 月次サマリー
| 項目 | 説明 |
|------|------|
| 勤務日数 | — |
| 合計実働時間 | — |
| 時給単価 | 管理者・本人のみ |
| 給与見込み額 | 管理者・本人のみ |
| 承認状態 | 未確認 / 確認済 / 承認済 |

## 操作
| 操作 | 説明 |
|------|------|
| OK ボタン（インターン） | 当月勤怠を確認済みとしてマーク（S2 フェーズ③④） |
| 修正依頼 | コメント付きで管理者に修正を依頼 |
| 修正（管理者） | 出退勤時刻・休憩時間を直接編集 |
| 承認（管理者・マネージャー） | 勤怠を最終承認 |
| 配分編集 | 日別のプロジェクト配分を編集（合計≠実働は保存不可） |

## エラー / 例外
| 条件 | 挙動 |
|------|------|
| 打刻漏れ日 | 行をオレンジ強調。管理者が手動登録可 |
| 既に承認済みの修正 | 「承認済みの勤怠は修正できません。管理者にお問い合わせください」 |
| 配分合計 ≠ 実働 | 「プロジェクト配分の合計が実働と一致しません」 |

## 権限（ロール別）
| ロール | 閲覧 | OK / 修正依頼 | 修正 | 承認 | 配分編集 |
|--------|------|--------------|------|------|-----------|
| 管理者 | 全員 | — | ○ | ○ | ○ |
| マネージャー | 担当 PJ メンバー | — | — | ○（担当のみ） | ○（担当のみ） |
| 社員 | 自分のみ | — | — | — | ○（自分のみ） |
| インターン | 自分のみ | ○ | — | — | ○（自分のみ） |

## 関連データ（エンティティ）
- `ATTENDANCE`、`MEMBER`

## 関連 API
- `GET /api/attendance?memberId=&month=`
- `PUT /api/attendance/:id`
- `POST /api/attendance/:memberId/confirm`
- `POST /api/attendance/:memberId/approve`

## ワイヤーフレーム（ASCII）
```
┌────────────────────────────── 勤怠一覧 ──────────────────────────────┐
│ 月: [2026-02▼]   メンバー: [山田▼]   ステータス: [すべて▼]               │
│                                                                             │
│ 日付 | 出勤 | 退勤 | 休憩 | 実働 | 日報                | 状態 | 操作        │
│ 2/01 | 10:00| 19:00| 60  | 8:00 | API実装             | 通常 | [修正依頼]   │
│ 2/02 | 10:00| 15:00| 30  | 4:30 | テスト               | 打刻漏れ🟧 | [管理者手動登録] │
│ 2/03 | 休み |      |     |      |                      | 休     |             │
│ ...                                                                        │
│                                                                             │
│ 月次サマリー: 勤務日数 18日 / 合計実働 142h / 時給 ¥2,000 / 給与見込 ¥284,000 │
│ 会社別請求見込: Boost ¥170,000 / SALT2 ¥114,000（本人・管理者）             │
│ 承認状態: 未確認 → 確認済（OKボタン） → 承認済（管理者/担当Mgr）            │
│ 操作: [OK（確認済にする）]  [修正依頼を送る]  管理者/担当Mgr: [承認する]     │
│ 配分編集: 管理者/担当Mgr、本人が自分の行のみ編集可（合計≠実働は保存不可） │
│ 承認済みロック: 「承認済みの勤怠は修正できません」メッセージを上部表示        │
│ [ OK（確認済にする） ]   コメント: [________________]  [ 修正依頼を送る ]     │
└──────────────────────────────────────────────────────────────────────────┘
```
