# M6-01 PJ 別 PL

## 目的
プロジェクト単位の月次損益（売上・コスト・粗利）を確認し、掛け率と手動コストを管理する。

---

## PLの全体構造（重要）

### SALT2 ← Boost 案件のモデル

```
Boost（親会社）が外部クライアントから案件を受注
        ↓
SALT2 人員を Boost 案件に派遣
        ↓
SALT2 が Boost に請求:  人件費 × 掛け率 + ツール費等
        ↓
SALT2 の売上 = Boost への請求額
SALT2 の費用 = 人件費 + ツール費等
SALT2 の利益 ≈ 人件費 × (掛け率 - 1)  ← 掛け率次第
```

> **設計メモ**: SALT2 にとって「売上」は最初 0 ではなく、
> **Boost への請求額 = 人件費 × 掛け率 + ツール費** が売上となる。
> 掛け率（markup）は設定画面（C-03）で変更可能。

### SALT2 自社案件のモデル

```
SALT2 が独自に外部クライアントから案件を受注
        ↓
SALT2 の売上 = クライアントへの請求額
SALT2 の費用 = 人件費 + ツール費等
SALT2 の利益 = 売上 - 費用
```

---

## UI 構成
- PJ 選択ドロップダウン
- 対象月選択
- PL テーブル（売上・コスト・粗利・掛け率）
- 月次推移グラフ
- 手動コスト入力フォーム

## 表示項目（PL テーブル）

### Boost 案件の場合
| 区分 | 項目 | 計算方式 |
|------|------|---------|
| コスト | 人件費合計 | 自動計算（勤怠実績 × 時給 or 月額按分） |
| コスト | ツール費用 | 自動 / 手動入力 |
| コスト | 外注費 | 手動入力 |
| コスト | その他経費 | 手動入力 |
| コスト合計 | — | 自動計算 |
| 掛け率 | — | 設定値（C-03 で変更可、デフォルト 1.20） |
| **売上（Boost 請求額）** | 人件費合計 × 掛け率 + ツール費等 | 自動計算 |
| **粗利** | 売上 − コスト合計 | 自動計算 |
| 粗利率 | — | 自動計算（% 表示） |

### SALT2 自社案件の場合
| 区分 | 項目 | 計算方式 |
|------|------|---------|
| 売上 | 月額契約売上 | 手動入力 |
| コスト | 人件費合計 | 自動計算 |
| コスト | ツール費用・外注費等 | 手動入力 |
| **粗利** | 売上 − コスト | 自動計算 |

## 掛け率の可視化

掛け率画面では以下を表示:
- 現在の掛け率設定値
- **掛け率シミュレーション**:「掛け率を X.XX にすると月次粗利が ¥ YYY になる」
- 推奨掛け率の参考値（業界標準等）

## 入力項目
| 項目 | 必須 | 制約 | 例 |
|------|------|------|----|
| 月額契約売上（自社案件のみ） | 任意 | 0 以上の整数 | `500000` |
| ツール費用 | 任意 | 0 以上の整数 | `30000` |
| 外注費 | 任意 | 0 以上の整数 | `80000` |
| その他経費 | 任意 | 0 以上の整数 | `10000` |

## 操作
| 操作 | 説明 |
|------|------|
| 月切り替え | 前月・翌月ナビ |
| コスト入力 | 該当セルを直接編集 |
| 保存 | 手動入力値を保存 |

## 権限（ロール別）

> **変更点**: PL は管理者のみでなく**全メンバーが閲覧可能**。

| ロール | 閲覧 | 入力 |
|--------|------|------|
| 管理者 | 全 PJ | ○ |
| マネージャー | 全 PJ | 担当 PJ のみ |
| メンバー（社員・インターン共通） | 全 PJ（閲覧のみ） | 不可 |

## 関連データ（エンティティ）
- `PL_RECORD`、`PROJECT`、`PROJECT_ASSIGNMENT`、`ATTENDANCE`、`MEMBER`、`SYSTEM_SETTINGS`（掛け率）

## 関連 API
- `GET /api/pl/project/:id?month=`
- `PUT /api/pl/project/:id`
- `GET /api/pl/project/:id/simulate?markup=`（掛け率シミュレーション）
